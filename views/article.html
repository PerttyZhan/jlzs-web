<% include template/header.html %>

		<div class="article">
			<div class="container">
				<div class="article--left">
					<p class="article__catalog">
						<span><%=blog.typeName%></span>
						<span><%=blog.sort.sort%></span>
					</p>
					<p class="article__title" id="blog-title">
						<%=blog.headline%>
					</p>
					<div class="article__other">
						<p><%=blog.created_at%></p>
						<p>
							<span><%=blog.name%></span>
						</p>
					</div>

					<div class="article-face-img">
						<img data-original="<%=blog.img_src%>" class="lazy" alt="<%=blog.title%>" id="blog-img">
					</div>
					<% if (blog.title) { %>
						<div class="article-sm-title">
							<%=blog.title%>
						</div>
					<% } %>
					
					<div class="article__content">
						<!-- <iframe style="width: 100%" id="iframe" frameborder="0" scrolling="no">
							
						</iframe> -->
						<%-blog.content%>
					</div>
					
					<div class="article__tags">
				    	<% blog.tag.forEach(function(t){ %>
				    		<span><%=t.name%></span>
				    	<% }) %>
					</div>
					<div class="article-operate">
						<div class="article-operate-left">
							<div class="article-zan">
								<a href="#" id="zan" title="点赞">
									<i class="ion-thumbsup"></i>
									<span class="zan-animated">+1</span>
								</a>
								<span id="zan-show"><small><%=blog.like%></small></span>
							</div>
						</div>
						<div class="article-operate-right">
							<div class="article-share-nav">
								<div class="share-content">
									<a href="#" data-share="qq" title="QQ分享"><i class="fa fa-qq"></i></a>
									<a href="#" class="wx" title="微信分享">
										<i class="fa fa-weixin"></i>
										<div class="wx-qr">
											<img id="qrcode" width="100" height="100"/>
										</div>
									</a>
									<a href="#" data-share="wb" title="微博分享"><i class="fa fa-weibo"></i></a>
								</div>
							</div>
						</div>
					</div>
					<div class="article__relative-blog">
						<p class="article__relative-title">
							相关文章
						</p>
						<div class="relative-blog">
				    		<% relativeBlog.forEach(function(b){ %>
								<a href="/<%=b.difference%>/article/<%=b.id%>" title="<%=b.headline%>" class="relative-blog-item">
									<img data-original="<%=b.img_src%>" alt="<%=b.headline%>" />
									<p class="relative-blog-title">
										<span><%=b.headline%></span>
									</p>
								</a>
				    		<% }) %>
						</div>
					</div>

					<div id="uyan_frame"></div>
				</div>
				<div class="article--right">
					<div class="fancy-news" id="fancy">
						<p class="hot-title">
							精彩推荐
						</p>
						<% include template/fancy.html %>
					</div>
					
					<div class="hot-news">
						<p class="hot-title">
							热门文章
						</p>
						<div class="hot-list">
							<% include template/hotblog.html %>
						</div>
					</div>
				</div>
			</div>
		</div>

		<span class="goTop" id="goTop"><i class="ion-chevron-up"></i></span>
		<% include template/footer.html %>
	</body>

	<% include template/script.html %>
	<script src="https://cdn.bootcss.com/Swiper/3.4.2/js/swiper.min.js"></script>
	<script type="text/javascript">


		wx.ready(function () {
			wx.onMenuShareAppMessage({
				title: '<%=blog.headline%>', // 分享标题
			    desc: '<%=blog.title%>', // 分享描述
			    link: window.location.href, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
			    imgUrl: '<%=blog.img_src%>', // 分享图标
			    type: '', // 分享类型,music、video或link，不填默认为link
			    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
			    success: function () { 
			        // 用户确认分享后执行的回调函数
			        console.log('success')
			    },
			    cancel: function () { 
			        // 用户取消分享后执行的回调函数
			    }
			})

			wx.onMenuShareTimeline({
				title: '<%=blog.headline%>', // 分享标题
			    link: window.location.href, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
			    imgUrl: '<%=blog.img_src%>', // 分享图标
			    success: function () { 
			        // 用户确认分享后执行的回调函数
			        console.log('success')
			    },
			    cancel: function () { 
			        // 用户取消分享后执行的回调函数
			    }
			})
		})

		wx.error(function (res) {
			console.log(res)
		})

		var $qrcode = $('#qrcode');
		var $zanNum = $('#zan-show');
		$qrcode.attr( 'src', '/qrcode?text=' + encodeURI(window.location.href));

		$(function () {
			var zan_num = <%=blog.like%>;
			var $btnGoTop = $('#goTop');
			var $iframe = $('#iframe');
			var $zan = $('#zan');			


			$(window).scroll(function (e) {
				var scrollTop = $(window).scrollTop();
				if (scrollTop <= 788) {
					$btnGoTop.hide();
				}
				else {
					$btnGoTop.show();
				}
			})

			var mySwiper = new Swiper ('.swiper-container', {
				width: $('#fancy').width(),
			    loop: true,
			    autoplay: 3000,
			    lazyLoading : true,
				lazyLoadingInPrevNext : true,
			    // autoplay: 3000,
			    // 如果需要分页器
			    pagination: '.swiper-pagination',
			    
			    scrollbarHide: true
			})

			$btnGoTop.on('click', function () {
				$('html,body').animate({scrollTop: 0}, 500)
			})

			$zan.on('click', function (e) {
				e.preventDefault();
				var $this = $(this);

				
				$.ajax({
					url: '/article/like/<%=blog.id%>',
					data: {choice: '<%=blog.difference%>'},
					success: function (res) {
						if (!res.errcode) {
							$this
								.find('.zan-animated')
								.addClass('fadeOutTop')

							setTimeout(function () {
								$this.find('.zan-animated').removeClass('fadeOutTop');
							}, 1200)
							
							zan_num = zan_num + 1;
							$zanNum.find('small').text( zan_num );
						}
					},
					error: function (err) {
						console.log(err)
					}
				})	
			})

			$('#share').on('click', 'a', function (e) {
				e.preventDefault();
				var $this = $(this),
					$title = $('#blog-title'),
					$img = $('#blog-img');

				var type = $this.data('share'),
					title = encodeURI($title.text().trim()),
					picurl = encodeURI($img.attr('src'));

				var shareStr = '',
					url = encodeURI(window.location.href);

				if (type === 'qq') {
					shareStr = 'https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title='+title+'&url='+url+'&pics='+picurl;
				}
				else if (type === 'wb') {
					shareStr='http://service.weibo.com/share/share.php?title='+title+'&url='+url+'&content=utf-8&sourceUrl='+url+'&pics='+picurl
				}

				if (shareStr) {
					window.open(shareStr);
				}
			})
		})
	</script>
</html>
